using System;
using System.IO;
using Aspose.Pdf;
using Aspose.Pdf.Facades;
using Aspose.Pdf.Printing;
using Aspose.Pdf.Devices;
using System.Drawing.Printing;
using System.Windows.Forms;

namespace Examples.Core.AsposePdfFacades.Printing;

public class PrintToDefaultPrinter
{
    /// <summary>
    /// Prints a PDF document to the default printer without showing any dialogs.
    /// </summary>
    public static void Run()
    {
        try
        {
            // Resolve the input PDF path (data/inputs/input.pdf)
            string dataDir = GetDataDir();
            string inputPath = Path.Combine(dataDir, "input.pdf");

            // Create PdfViewer object
            using var viewer = new PdfViewer();

            // Open input PDF file
            viewer.BindPdf(inputPath);

            // Set attributes for printing
            viewer.AutoResize = true;       // Print the file with adjusted size
            viewer.AutoRotate = true;       // Print the file with adjusted rotation
            viewer.PrintPageDialog = false; // Do not produce the page number dialog when printing

            // Create printer and page settings
            var printerSettings = new PrinterSettings();
            var pageSettings = new PageSettings();

            // Set printer name to the system default printer
            using var printDoc = new PrintDocument();
            printerSettings.PrinterName = printDoc.PrinterSettings.PrinterName;

            // Set PageSize (if required)
            pageSettings.PaperSize = new PaperSize("A4", 827, 1169);

            // Set PageMargins (if required)
            pageSettings.Margins = new Margins(0, 0, 0, 0);

            // Print document using printer and page settings
            viewer.PrintDocumentWithSettings(pageSettings, printerSettings);

            // Close the PDF file after printing
            viewer.Close();
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error during printing: {ex.Message}");
        }
    }

    /// <summary>
    /// Shows a print dialog before printing the PDF document.
    /// </summary>
    public static void ShowPrintDialog()
    {
        try
        {
            // Resolve the input PDF path (data/inputs/input.pdf)
            string dataDir = GetDataDir();
            string inputPath = Path.Combine(dataDir, "input.pdf");

            // Create PdfViewer object
            using var viewer = new PdfViewer();

            // Open input PDF file
            viewer.BindPdf(inputPath);

            // Set attributes for printing
            viewer.AutoResize = true;       // Print the file with adjusted size
            viewer.AutoRotate = true;       // Print the file with adjusted rotation
            viewer.PrintPageDialog = false; // Do not produce the page number dialog when printing

            // Create printer and page settings
            var printerSettings = new PrinterSettings();
            var pageSettings = new PageSettings();

            // Set printer name to the system default printer
            using var printDoc = new PrintDocument();
            printerSettings.PrinterName = printDoc.PrinterSettings.PrinterName;

            // Set PageSize (if required)
            pageSettings.PaperSize = new PaperSize("A4", 827, 1169);

            // Set PageMargins (if required)
            pageSettings.Margins = new Margins(0, 0, 0, 0);

            // Show print dialog
            using var printDialog = new PrintDialog();
            if (printDialog.ShowDialog() == DialogResult.OK)
            {
                // Print document using printer and page settings
                viewer.PrintDocumentWithSettings(pageSettings, printerSettings);
            }

            // Close the PDF file after printing
            viewer.Close();
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error during print dialog operation: {ex.Message}");
        }
    }

    private static string GetDataDir()
    {
        // Base directory of the application
        string baseDir = AppContext.BaseDirectory;
        string dataDir = Path.Combine(baseDir, "data", "inputs");

        // Ensure the directory exists
        if (!Directory.Exists(dataDir))
        {
            Directory.CreateDirectory(dataDir);
        }

        return dataDir;
    }
}